const __feature__="allfeatures",__marker__="pin";customElements.define("leaflet-map",class extends HTMLElement{get CDN(){return this.getAttribute("cdn")||"//unpkg.com/leaflet@"+(this.getAttribute("version")||"latest")+"/dist"}get tileLayer(){return this.getAttribute("tilelayer")||"//tile.openstreetmap.org/{z}/{x}/{y}.png"}get mapdiv(){return this.shadowRoot.querySelector("div")}constructor(){super().attachShadow({mode:"open"}).innerHTML="<style>.leaflet-control-zoom{display:none}</style>"+`<link rel="stylesheet" href="${this.CDN}/leaflet.css" onload="this.getRootNode().host.mapdiv.style.opacity=1">`+'<div style="width:100%;height:100%;opacity:0"/>',this.markers=[],this.features=new Map}connectedCallback(){let e=()=>{this.L=window.L,this.render(),this.addmarkers()};window.L&&window.L.map?e():document.head.append(Object.assign(document.createElement("script"),{src:this.CDN+"/leaflet.js",onload:()=>e()}))}render(){this.shadowRoot.append(...this.querySelectorAll("[shadowRoot]")),this.map=this.L.map(this.mapdiv),this.map.addLayer(this.L.tileLayer(this.tileLayer,{})),this.map.on("click",e=>this.mapclick(e)),this.map.on("zoomstart",e=>this.mapzoomstart(e)),this.map.on("zoomend",e=>this.mapzoomend(e)),this.setView({lat:this.getAttribute("lat")||52.2957,lng:this.getAttribute("lng")||4.6804})}mapclick(e){if(e.originalEvent.ctrlKey){let{lat:t,lng:a}=e.latlng,r=this.marker({lat:t,lng:a,feature:"latlng"});this.markerlabel({marker:r,lat:t,lng:a,label:`lat:${t}<br>lng:${a}`})}}mapzoomstart(e){}mapzoomend(e){}addmarkers({markers:e}={markers:this.querySelectorAll("marker")}){e.forEach(e=>{let t=t=>e.getAttribute(t)||e.parentNode.getAttribute(t);this.marker({markerNode:e,lat:e.getAttribute("lat")||void 0,lng:e.getAttribute("lng")||void 0,popup:e.innerHTML,openPopup:e.hasAttribute("openPopup"),feature:t("feature")||__feature__,icon:t("icon")||__marker__})}),this.fitBounds({feature:this.getAttribute("feature")||__feature__})}fitBounds({feature:e}){if(e){let t=this.getFeatureGroup(e),a=t.getLayers().length;a>1?this.map.fitBounds(t.getBounds()):a?this.map.panInsideBounds(t.getBounds()):console.warn(`no fitBounds: ${e}`)}}getFeatureGroup(e){return e?this.features.get(e)||this.features.set(e,this.L.featureGroup()).get(e):this.getFeatureGroup(__feature__)}feature({feature:e=__feature__,node:t}){t.addTo(this.getFeatureGroup(e)),e!=__feature__&&t.addTo(this.getFeatureGroup(__feature__))}setView({lat:e=52.2957,lng:t=4.6804,zoom:a=this.getAttribute("zoom")||13}){this.map.setView([e,t],a)}circle({lat:e,lng:t,color:a="green",fillColor:r="lightgreen",fillOpacity:i=.5,radius:o=100}){let s=this.L.circle([e,t],{color:a,fillColor:r,fillOpacity:i,radius:o});return s.addTo(this.map),s}marker({markerNode:e,lat:t=52.2957,lng:a=4.6804,popup:r,openPopup:i=!1,icon:o,feature:s,label:l=e.getAttribute("label")}){let n=this.L.marker([t,a],{icon:this.L.divIcon({html:`<leaflet-marker-icon icon="${o}"></leaflet-marker-icon>`,className:"marker-svg",iconSize:[40,80],iconAnchor:[20,38]})});return this.markers.push(n),n.addTo(this.map),this.feature({node:n,feature:s}),this.markerlabel({marker:n,lat:t,lng:a,label:l}),r&&n.bindPopup(r,{offset:this.L.point(0,-30)}),i&&n.openPopup(),n}markerlabel({marker:e,lat:t,lng:a,label:r}){r&&("postcode"==r?fetch(`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${t}&lon=${a}`).then(t=>{t.json().then(t=>{r=t.address.postcode,e.bindTooltip(r,{permanent:!0,direction:"bottom"}).addTo(this.map)})}):e.bindTooltip(r,{permanent:!0,direction:"bottom"}).addTo(this.map))}}),customElements.define("leaflet-marker-icon",class extends HTMLElement{connectedCallback(){let e=this.getAttribute("icon");if(e.includes("."))this.innerHTML=`<img src="${e}" />`;else{let t="130;m65 0c-24 0-43 19-43 43 0 8 2 15 6 21 2 3 0 0 2 3l36 62 36-62c2-3 0 0 2-3 4-6 6-14 6-21 0-24-19-42-45-43zm0 22c12 0 22 10 22 22 0 12-10 22-22 22s-22-10-22-22c0-12 10-22 22-22z",a={bus:"110;m10 72c0 4 2 8 5 11v9c0 3 2 5 5 5h5c3 0 5-2 5-5v-5h40v5c0 3 2 5 5 5h5c3 0 5-2 5-5v-9c3-3 5-7 5-11v-50c0-18-18-20-40-20s-40 3-40 20v50zm18 5c-4 0-8-3-8-8s3-8 8-8 8 3 8 8-3 8-8 8zm45 0c-4 0-8-3-8-8s3-8 8-8 8 3 8 8-3 8-8 8zm8-30h-60v-25h60v25z",house:"170;m160 90a5 5 90 01-4-2l-72-72-72 72a5 5 90 01-7-7l75-75a5 5 90 017 0l75 75a5 5 90 01-3 9zm-76-56-60 60v61a10 10 90 0010 10h35v-50h30v50h35a10 10 90 0010-10v-61z"}[e]||t,[r,i]=a.split(";");this.innerHTML=`<svg viewBox="0 0 ${r} ${r}">`+"<style>path{fill:var(--lfm-marker,firebrick)}</style>"+`<path d="${i}"/>`+"</svg>"}}});